<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Meet Swamiji | Chinmaya Mission</title>

  <!-- Tailwind & Axios -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>

  <style>
    /* Hide Scrollbar */
    .no-scrollbar::-webkit-scrollbar {
      display: none;
    }

    .no-scrollbar {
      -ms-overflow-style: none;
      scrollbar-width: none;
    }

    /* Timeline styling */
    .timeline-dot {
      box-shadow: 0 0 0 4px white, 0 0 10px rgba(249, 115, 22, 0.6);
      z-index: 2;
    }

    .timeline-line {
      background: linear-gradient(90deg, rgba(255, 175, 80, 0.9), rgba(255, 110, 40, 0.9));
      height: 4px;
      position: absolute;
      top: 38px;
      left: 0;
      z-index: 0;
    }

    /* Cards */
    .card {
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.05);
      border-radius: 0.75rem;
      overflow: hidden;
      background: white;
    }

    /* Timeline container */
    #timeline {
      display: flex;
      gap: 3rem;
      overflow-x: auto;
      scroll-snap-type: x mandatory;
      width: 100%;
      justify-content: flex-start;
      padding: 2rem 6rem;
      position: relative;
    }

    #timeline>div {
      scroll-snap-align: center;
      flex-shrink: 0;
      width: 260px;
      z-index: 1;
    }

    /* ‚úÖ Responsive only ‚Äî keep desktop as is */
    @media (max-width: 1024px) {
      #timeline {
        gap: 2rem;
        padding: 2rem;
      }

      #timeline>div {
        width: 240px;
      }
    }

    @media (max-width: 768px) {
      /* Only 1 card visible at a time */
      #timeline {
        gap: 0;
        padding: 1rem;
        overflow-x: auto;
        scroll-snap-type: x mandatory;
      }

      #timeline>div {
        width: 90%;
        flex-shrink: 0;
        margin: 0 auto;
        scroll-snap-align: center;
      }

      .card img {
        height: 200px;
      }

      /* Move arrows below timeline */
      #scrollLeft,
      #scrollRight {
        bottom: -2.5rem;
        top: auto;
        width: 2.5rem;
        height: 2.5rem;
      }

      #scrollLeft {
        left: 30%;
      }

      #scrollRight {
        right: 30%;
      }

      h2 {
        font-size: 1.5rem;
      }

      p {
        font-size: 0.9rem;
      }
    }

    @media (max-width: 480px) {
      #timeline>div {
        width: 95%;
      }

      .card img {
        height: 180px;
      }

      .card .p-3 {
        padding: 0.75rem;
      }

      h4 {
        font-size: 0.9rem;
      }

      .text-xs {
        font-size: 0.7rem;
      }
    }
  </style>
</head>

<body class="bg-white text-[#0f254a] font-sans">
  <section class="py-16 w-full">
    <!-- Header -->
    <div class="text-center mb-10 px-6">
      <h2 class="text-3xl font-bold flex items-center justify-center gap-2">
        <span class="text-orange-500 text-2xl">‚ú¶</span>
        Meet Swamiji
        <span class="text-orange-500 text-2xl">‚ú¶</span>
      </h2>
      <p class="text-gray-600 mt-3 max-w-3xl mx-auto text-lg">
        Join Swami Swaroopananda for life-changing camps, meditation courses, and Vedanta talks held across various
        locations around the world.
      </p>
    </div>

    <!-- Timeline -->
    <div class="relative max-w-[1600px] mx-auto flex items-center justify-center w-full">
      <!-- Left Arrow -->
      <button id="scrollLeft"
        class="absolute left-2 lg:left-0 z-20 bg-white border border-orange-400 text-orange-500 w-8 h-8 rounded-full flex items-center justify-center shadow hover:bg-orange-50 transition">
        ‚Üê
      </button>

      <!-- Scrollable container -->
      <div id="timeline" class="no-scrollbar scroll-smooth">
        <!-- Timeline line -->
        <div class="timeline-line"></div>
      </div>

      <!-- Right Arrow -->
      <button id="scrollRight"
        class="absolute right-2 lg:right-0 z-20 bg-white border border-orange-400 text-orange-500 w-8 h-8 rounded-full flex items-center justify-center shadow hover:bg-orange-50 transition">
        ‚Üí
      </button>
    </div>
  </section>

  <script type="module">
    const API_URL = "https://admin.chinmayamission.com/api/graphql";

    const query = `
    query ItineraryList($filter: GetItineraryFilterInput) {
      ItineraryList(filter: $filter) {
        docs {
          id
          image { url }
          itineraryType
          userType
          purpose
          venue
          center { name slug address1 address2 address3 pincode country state city locationPhoneNumber }
          fromDate
          toDate
          country
          state
          city
          address
          phoneNumber
          status
          slug
          updatedAt
          createdAt
          eventName {
            id
            image { url }
            title
          }
          fromTime
          toTime
          duration
          centerName { name slug address1 address2 address3 pincode country state city locationPhoneNumber }
          flyer { url }
          userName { id slug type title }
        }
      }
    }`;

    const variables = {
      filter: {
        userId: "67a469eeeaf7c8571bdf3db1",
        userType: "Swami"
      }
    };

    async function fetchItineraryData() {
      try {
        const res = await axios.post(API_URL, { query, variables }, {
          headers: { "Content-Type": "application/json" }
        });

        const data = res.data.data.ItineraryList.docs;
        const timeline = document.getElementById("timeline");

        if (!data?.length) {
          timeline.innerHTML = "<p class='text-gray-500 w-full text-center'>No upcoming events found.</p>";
          return;
        }

        data.forEach(item => {
          const title = item.eventName?.title || "Untitled Event";
          const image = item.eventName?.image?.url || item.flyer?.url;
          const flyer = item.flyer?.url;
          const fromDate = new Date(item.fromDate);
          const dateText = fromDate.toLocaleDateString("en-GB", {
            day: "numeric",
            month: "long",
            year: "numeric"
          });

          const center = item.centerName || {};
          const centerName = center.name || "";
          const addressLines = [
            center.address1,
            center.address2,
            center.address3,
            center.city,
            center.state,
            center.country,
            center.pincode
          ].filter(Boolean);
          const phone = center.locationPhoneNumber || "";

          const card = document.createElement("div");
          card.className = "flex flex-col items-left relative";

          card.innerHTML = `
            <div class="relative flex flex-col items-center mb-8">
              <div class="w-5 h-5 bg-orange-500 rounded-full timeline-dot z-10"></div>
              <p class="mt-8 text-sm font-medium text-gray-700 text-center whitespace-nowrap">${dateText}</p>
            </div>

            <div class="card overflow-hidden rounded-lg">
              <img src="${image}" alt="${title}" class="w-full h-36 object-cover rounded-lg">
              <div class="p-3 flex flex-col justify-between flex-grow">
                <div>
                  <h4 class="font-semibold text-base mb-1 text-gray-800 leading-tight">${title}</h4>
                  ${centerName ? `<p class="text-xs text-orange-600 font-medium mb-1">${centerName}</p>` : ""}
                  ${addressLines.length ? `<p class="text-xs text-gray-600 leading-snug">${addressLines.join(", ")}</p>` : ""}
                  ${phone ? `<p class="text-xs text-gray-600 mt-1">${phone}</p>` : ""}
                </div>
                ${flyer ? `<a href="${flyer}" target="_blank" class="inline-block mt-2 text-orange-600 text-xs font-medium underline">üìÑ View Flyer</a>` : ""}
              </div>
            </div>
          `;

          timeline.appendChild(card);
        });

        const timelineLine = timeline.querySelector(".timeline-line");
        timelineLine.style.width = `${timeline.scrollWidth}px`;

        window.addEventListener("resize", () => {
          timelineLine.style.width = `${timeline.scrollWidth}px`;
        });

      } catch (err) {
        console.error("GraphQL fetch failed:", err);
        document.getElementById("timeline").innerHTML =
          "<p class='text-red-500 text-center'>‚ùå Failed to load events.</p>";
      }
    }

    const scrollContainer = document.getElementById("timeline");
    document.getElementById("scrollLeft").onclick = () =>
      scrollContainer.scrollBy({ left: -window.innerWidth * 0.9, behavior: "smooth" });
    document.getElementById("scrollRight").onclick = () =>
      scrollContainer.scrollBy({ left: window.innerWidth * 0.9, behavior: "smooth" });

    fetchItineraryData();
  </script>
</body>

</html>

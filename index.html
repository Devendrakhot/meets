<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Meet Swamiji | Chinmaya Mission</title>

  <!-- Tailwind & Axios -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>

  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Philosopher:wght@400;700&family=Lexend:wght@300;400;500;600;700&display=swap" rel="stylesheet">

  <style>
    :root {
      --primary-color: #2A0001;
      --secondary-color: #DAA864;
    }

    body {
      font-family: 'Lexend', sans-serif;
      color: var(--primary-color);
      background: white;
    }

    h1,
    h2,
    h3,
    h4,
    h5,
    h6,
    .font-primary {
      font-family: 'Philosopher', sans-serif;
      color: var(--primary-color);
    }

    .text-primary {
      color: var(--primary-color);
    }

    .text-secondary {
      color: var(--secondary-color);
    }

    /* === Timeline Styling === */
    .no-scrollbar::-webkit-scrollbar {
      display: none;
    }

    .no-scrollbar {
      -ms-overflow-style: none;
      scrollbar-width: none;
    }

    .timeline-dot {
      background: var(--primary-color);
      width: 1.25rem;
      height: 1.25rem;
      border-radius: 50%;
      position: relative;
      top: 2px;
      z-index: 10;
      flex-shrink: 0;
    }

    .timeline-line {
      background: var(--secondary-color);
      height: 4px;
      position: absolute;
      top: 42px;
      width: 100%;
      z-index: 0;
    }

    .card {
      border-radius: 0.75rem;
      overflow: hidden;
      background: white;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
    
    }

    #timeline {
      display: flex;
      overflow-x: auto;
      scroll-snap-type: x mandatory;
      width: 100%;
      justify-content: space-between;
      padding: 2rem 2.6rem;
      position: relative;
      box-sizing: border-box;
    }

    #timeline>div {
      scroll-snap-align: center;
      flex-shrink: 0;
      width: calc(19% - 1.3rem);
      margin: 0 1.3rem;
      z-index: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    @media (max-width: 1280px) {
      #timeline>div {
        width: calc(25% - 2rem);
      }
    }

    @media (max-width: 1024px) {
      #timeline>div {
        width: calc(33.33% - 2rem);
      }
    }

    @media (max-width: 768px) {
      #timeline {
        padding: 1.5rem 1rem;
      }

      #timeline>div {
        width: 80%;
        margin: 0 1rem;
      }

      .timeline-dot {
        width: 18px;
        height: 18px;
      }

      .timeline-line {
        top: 35px;
      }
    }
  </style>
</head>

<body>

  <!-- üåü Meet Swamiji Profile Section -->
  <section class="max-w-[1250px] mx-auto pt-20 pb-10 md:py-20 px-4">
    <div class="md:flex justify-center gap-[60px] items-stretch">
      <!-- Image -->
      <div id="swamiji-image"
        class="max-w-[600px] flex-1 aspect-[3/2] flex items-center justify-center bg-gray-100 rounded-3xl">
        <p class="text-secondary text-center">Loading image...</p>
      </div>

      <!-- Content -->
      <div class="max-w-[652px] flex flex-col justify-between flex-1 mt-6 md:mt-0 py-4">
        <div class="flex flex-col gap-4">
          <h4 id="swamiji-name"
            class="text-primary font-bold text-2xl md:text-[40px] md:leading-[46px] font-primary">
            Loading...
          </h4>

          <p id="swamiji-title"
            class="text-[#DAA864] font-semibold text-base md:text-xl uppercase">
            Please wait
          </p>

          <p id="swamiji-desc"
            class="text-primary text-sm md:text-lg md:leading-7 text-justify">
            Fetching content from Chinmaya Mission CMS...
          </p>
        </div>

        <!-- Social Links -->
        <div class="flex items-center gap-6 mt-6">
          <strong class="text-primary font-bold text-xl md:text-2xl font-primary">Follow on</strong>
          <div class="flex gap-4" id="swamiji-socials">
            <a target="_blank" href="https://www.facebook.com/share/16YxYGW9pH/?mibextid=wwXIfr">
              <img src="https://www.chinmayamission.com/images/Home-page/facebook.svg" alt="Facebook"
                class="w-8 h-8 md:w-10 md:h-10 hover:scale-110 transition-transform duration-300" />
            </a>
            <a target="_blank" href="https://www.instagram.com/swamiswaroopananda?igsh=aTFzOXpjMmdkY3kw">
              <img src="https://www.chinmayamission.com/images/Home-page/instagram.svg" alt="Instagram"
                class="w-8 h-8 md:w-10 md:h-10 hover:scale-110 transition-transform duration-300" />
            </a>
            <a target="_blank" href="https://x.com/swswaroopananda?s=21">
              <img src="https://www.chinmayamission.com/images/Home-page/twitter.svg" alt="Twitter"
                class="w-8 h-8 md:w-10 md:h-10 hover:scale-110 transition-transform duration-300" />
            </a>
            <a target="_blank" href="https://whatsapp.com/channel/0029Val828lDZ4LhFJxe801v">
              <img src="https://www.chinmayamission.com/images/Home-page/whatsAppIcon.svg" alt="WhatsApp"
                class="w-8 h-8 md:w-10 md:h-10 hover:scale-110 transition-transform duration-300" />
            </a>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- üåç Swamiji's Event Timeline -->
  <section class="py-16 w-full">
    <!-- Header -->
    <div class="text-center mb-10 px-6">
      <h2 class="text-3xl font-bold flex items-center justify-center gap-2 text-[#2A0001]">
        <span class="text-orange-500 text-2xl">‚ú¶</span>
        Meet Swamiji
        <span class="text-orange-500 text-2xl">‚ú¶</span>
      </h2>
      <p class="text-gray-600 mt-3 max-w-3xl mx-auto text-lg">
        Join Swami Swaroopananda for life-changing camps, meditation courses, and Vedanta talks held across various
        locations around the world.
      </p>
    </div>

    <!-- Timeline -->
    <div class="relative max-w-[1600px] mx-auto flex items-center justify-center w-full">
      <!-- Left Arrow -->
      <button id="scrollLeft"
        class="absolute left-2 lg:left-0 z-20 bg-white border border-orange-400 text-orange-500 w-8 h-8 rounded-full flex items-center justify-center shadow hover:bg-orange-50 transition">
        ‚Üê
      </button>

      <!-- Scrollable container -->
      <div id="timeline" class="no-scrollbar scroll-smooth">
        <!-- Timeline line -->
        <div class="timeline-line"></div>
      </div>

      <!-- Right Arrow -->
      <button id="scrollRight"
        class="absolute right-2 lg:right-0 z-20 bg-white border border-orange-400 text-orange-500 w-8 h-8 rounded-full flex items-center justify-center shadow hover:bg-orange-50 transition">
        ‚Üí
      </button>
    </div>
  </section>


  <!-- ======================= -->
  <!-- üîπ FETCH DATA SCRIPTS üîπ -->
  <!-- ======================= -->
  <script>
    /* === Swamiji Bio Fetch === */
    const CMS_API = "https://cms.chinmayamission.com/graphql";
    const BASE_URL = "https://cms.chinmayamission.com";
    const slug = "/";

    const cmsQuery = `
      query {
        pages(filters: { slug: { eq: "${slug}" } }) {
          slug
          contentSections {
            __typename
            ... on ComponentSectionsPageBlockGroup {
              page_blocks {
                view_template
                page_block_title
                page_block_short_text
                block_detail {
                  info_title
                  info_short_text
                  info_description
                  media { url }
                }
              }
            }
          }
        }
      }
    `;

    function getMediaUrl(media) {
      if (!media) return "";
      if (typeof media === "string") return media.startsWith("/") ? BASE_URL + media : media;
      if (media.url) return media.url.startsWith("/") ? BASE_URL + media.url : media.url;
      return "";
    }

    async function loadSwamijiProfile() {
      try {
        const res = await axios.post(CMS_API, { query: cmsQuery });
        const page = res.data?.data?.pages?.[0];
        if (!page) return;

        const blocks = page.contentSections
          .filter(cs => cs.__typename === "ComponentSectionsPageBlockGroup")
          .flatMap(cs => cs.page_blocks)
          .filter(b => (b.view_template || "").toLowerCase().includes("one_1048"));

        const swamijiBlock = blocks[1];
        const detail = swamijiBlock?.block_detail?.[0];
        if (!detail) return;

        document.getElementById("swamiji-name").innerText = swamijiBlock.page_block_title || "";
        document.getElementById("swamiji-title").innerText = swamijiBlock.page_block_short_text ;
        document.getElementById("swamiji-desc").innerHTML = detail.info_description || "";

        const imgUrl = getMediaUrl(detail.media);
        if (imgUrl) {
          document.getElementById("swamiji-image").innerHTML = `
            <img src="${imgUrl}" alt="${detail.info_title || ''}"
              class="rounded-3xl object-cover w-full h-full shadow-[8px_8px_4px_rgba(0,0,0,0.16)]" />
          `;
        }
      } catch (err) {
        console.error("Swamiji profile fetch failed:", err);
      }
    }

    loadSwamijiProfile();
  </script>

<script type="module">
    const API_URL = "https://admin.chinmayamission.com/api/graphql";

    const query = `
    query ItineraryList($filter: GetItineraryFilterInput) {
      ItineraryList(filter: $filter) {
        docs {
          id
          image { url }
          itineraryType
          userType
          purpose
          venue
          center { name slug address1 address2 address3 pincode country state city locationPhoneNumber }
          fromDate
          toDate
          country
          state
          city
          address
          phoneNumber
          status
          slug
          updatedAt
          createdAt
          eventName {
            id
            image { url }
            title
          }
          fromTime
          toTime
          duration
          centerName { name slug address1 address2 address3 pincode country state city locationPhoneNumber }
          flyer { url }
          userName { id slug type title }
        }
      }
    }`;

    // Get today's date in MM/DD/YYYY format
    const today = new Date();

    // Format helper (MM/DD/YYYY)
    const formatDate = (date) => {
      const mm = String(date.getMonth() + 1).padStart(2, "0");
      const dd = String(date.getDate()).padStart(2, "0");
      const yyyy = date.getFullYear();
      return `${mm}/${dd}/${yyyy}`;
    };

    // Start date = today
    const startDate = formatDate(today);

    // End date = exactly 1 year from today
    const nextYear = new Date(today);
    nextYear.setFullYear(today.getFullYear() + 1);
    const endDate = formatDate(nextYear);

    // Use in GraphQL variables
    const variables = {
      filter: {
        userId: "67a469eeeaf7c8571bdf3db1",
        userType: "Swami",
        startDate: startDate,
        endDate: endDate,
      },
    };


    async function fetchItineraryData() {
      try {
        const res = await axios.post(
          API_URL,
          { query, variables },
          { headers: { "Content-Type": "application/json" } }
        );

        const data = res.data.data.ItineraryList.docs;
        const timeline = document.getElementById("timeline");

        if (!data?.length) {
          timeline.innerHTML =
            "<p class='text-gray-500 w-full text-center'>No upcoming events found.</p>";
          return;
        }

        // ‚úÖ Sort by fromDate ascending
        data.sort((a, b) => new Date(a.fromDate) - new Date(b.fromDate));

        data.forEach((item) => {
          const title =
            item.eventName?.title || item.purpose || "Untitled Itinerary";
          const image =
            item.eventName?.image?.url ||
            item.flyer?.url ||
            item.image?.url ||
            "https://via.placeholder.com/400x250?text=No+Image";
          const flyer = item.flyer?.url;
          const fromDate = new Date(item.fromDate);
          const dateText = fromDate.toLocaleDateString("en-GB", {
            day: "numeric",
            month: "long",
            year: "numeric",
          });

          const center = item.centerName || item.center || {};
          const centerName = center.name || "";
          const addressLines = [
            center.address1,
            center.address2,
            center.address3,
            center.city,
            center.state,
            center.country,
            center.pincode,
          ].filter(Boolean);
          const phone = center.locationPhoneNumber || item.phoneNumber || "";

          const card = document.createElement("div");
          card.className = "flex flex-col items-center relative";

          card.innerHTML = `
  <div class="flex flex-col items-center mb-6 relative z-10">
    <div class="timeline-dot"></div>
    <p class="timeline-date">${dateText}</p>
  </div>

  <div class="card">
    <img src="${image}" alt="${title}" class="rounded-lg">
    <div class="p-3 flex flex-col justify-between flex-grow">
      <div>
        <h4 class="font-semibold text-base mb-1 text-[#2A0001] leading-tight">${title}</h4>
        ${centerName ? `<p class="text-xs text-[#B2A8A0] font-medium mb-1">${centerName}</p>` : ""}
        ${addressLines.length ? `<p class="text-xs text-gray-600 leading-snug">${addressLines.join(", ")}</p>` : ""}
        ${phone ? `<p class="text-xs text-gray-600 mt-1">${Array.isArray(phone) ? phone.join(", ") : phone}</p>` : ""}
      </div>
      ${flyer ? `<a href="${flyer}" target="_blank" class="inline-block mt-2 text-[#2A0001] text-xs font-medium underline">View Flyer</a>` : ""}
    </div>
  </div>
`;


          timeline.appendChild(card);
        });

        const timelineLine = timeline.querySelector(".timeline-line");
        timelineLine.style.width = `${timeline.scrollWidth}px`;

        window.addEventListener("resize", () => {
          timelineLine.style.width = `${timeline.scrollWidth}px`;
        });
      } catch (err) {
        console.error("GraphQL fetch failed:", err);
        document.getElementById("timeline").innerHTML =
          "<p class='text-red-500 text-center'>‚ùå Failed to load events.</p>";
      }
    }

    const scrollContainer = document.getElementById("timeline");
    document.getElementById("scrollLeft").onclick = () =>
      scrollContainer.scrollBy({
        left: -window.innerWidth * 0.9,
        behavior: "smooth",
      });
    document.getElementById("scrollRight").onclick = () =>
      scrollContainer.scrollBy({
        left: window.innerWidth * 0.9,
        behavior: "smooth",
      });

    fetchItineraryData();
  </script>
</body>
</html>
